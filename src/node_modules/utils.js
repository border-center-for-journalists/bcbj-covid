import Papa from 'papaparse';

export async function serialize(dataSource) {
    const res = await fetch(dataSource);
    const csv = await res.text();
    const json = Papa.parse(csv.trim(), { header: true }).data;
    console.log(json);
    return json;
}

export async function getMarkers() {
    const data = await serialize('https://raw.githubusercontent.com/el-sonny/mxcovidserialize/master/data/output/csv/confirmed-time-series.csv');
    const markers = data.map(m => {
        const radius = Math.ceil(m['28-04-20']*40/800);
        return L.circleMarker([m.popCenterLat, m.popCenterLon], {
            radius,
            color: '#f96061',
            weight: 1,
        });
    });
    const layer = L.layerGroup(markers);
    return layer;
}